<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Roboto:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/css/style.css" />
  </head>
  <body>
    <div class="app">
      <header id="header" class="header">
        <p class="header-title">Total Budget</p>
        <div class="header-budget">
          <span class="header-budget__money">$2</span>
        </div>
      </header>
      <div class="category" id="category">
        <div class="category-left">
          <p class="category-left__title">Category</p>
          <div class="category-left__action">
            <span class="category-left__prev">Previous</span>
            <span class="category-left__next">Next</span>
          </div>
        </div>
        <ul class="category-right">
          <li class="category-right__item">
            <div class="category-right__wrap">
              <img
                src="./assets/img/salary.png"
                alt=""
                class="category-right__img"
              />
            </div>
            <p class="category-right__text">Salary</p>
          </li>
          <li class="category-right__item">
            <div class="category-right__wrap">
              <img
                src="./assets/img/gift.png"
                alt=""
                class="category-right__img"
              />
            </div>
            <p class="category-right__text">Gift</p>
          </li>
          <li class="category-right__item">
            <div class="category-right__wrap">
              <img
                src="./assets/img/friend.png"
                alt=""
                class="category-right__img"
              />
            </div>
            <p class="category-right__text">Friend</p>
          </li>
          <li class="category-right__item">
            <div class="category-right__wrap">
              <img
                src="./assets/img/shopping.png"
                alt=""
                class="category-right__img"
              />
            </div>
            <p class="category-right__text">Shopping</p>
          </li>
          <li class="category-right__item">
            <div class="category-right__wrap">
              <img
                src="./assets/img/cooking.png"
                alt=""
                class="category-right__img"
              />
            </div>
            <p class="category-right__text">Cooking</p>
          </li>
          <li class="category-right__item">
            <div class="category-right__wrap">
              <img
                src="./assets/img/invoice.png"
                alt=""
                class="category-right__img"
              />
            </div>
            <p class="category-right__text">Invoice</p>
          </li>
          <li class="category-right__item">
            <div class="category-right__wrap">
              <img
                src="./assets/img/other.png"
                alt=""
                class="category-right__img"
              />
            </div>
            <p class="category-right__text">Other</p>
          </li>
        </ul>
      </div>
      <div class="bill" id="bill">
        <ul class="bill-template bill-template--income">
          <div class="bill-template__title bill--income">Income</div>
          <!-- <li class="bill-template__box">
            <div class="bill-template__wrap">
              <img
                src="./assets/img/salary.png"
                alt="salary"
                class="bill-template__img"
              />
            </div>
            <div class="bill-template__content">
              <p class="bill-template__title bill--income">Salary come</p>
              <p class="bill-template__price">$1400</p>
              <p class="bill-template__time">
                Created at:
                <span class="bill-template__date">Sun Oct 24 2021 </span>
              </p>
            </div>
          </li> -->
        </ul>
        <ul class="bill-template bill-template--cost">
          <div class="bill-template__title bill--cost">Cost</div>

          <!-- <li class="bill-template__box">
            <div class="bill-template__wrap bill--cost">
              <img
                src="./assets/img/salary.png"
                alt="salary"
                class="bill-template__img"
              />
            </div>
            <div class="bill-template__content">
              <p class="bill-template__title bill--cost">Salary come</p>
              <p class="bill-template__price">$1400</p>
              <p class="bill-template__time">
                Created at:
                <span class="bill-template__date">Sun Oct 24 2021 </span>
              </p>
            </div>
          </li> -->
        </ul>
      </div>

      <div class="modal">
        <div class="modal-body">
          <p class="modal-body__title">
            Create new: <span class="modal-body__topic">salary</span>
          </p>
          <form class="modal-body__form">
            <div class="modal-body__wrap">
              <input
                type="number"
                class="modal-body__control"
                name="amount"
                placeholder="amount"
              />
              <input
                type="text"
                class="modal-body__control"
                name="title"
                placeholder="title"
              />
            </div>
            <div class="modal-body__wrap">
              <textarea
                name="description"
                cols="30"
                rows="10"
                class="modal-body__control modal-body__description"
                placeholder="Description"
              ></textarea>
            </div>
            <p class="modal-body__mention">Choose type:</p>
            <div class="modal-body__frag">
              <input
                type="radio"
                checked
                name="action"
                id="income"
                class="modal-body__control"
                value="income"
              />
              <label for="income" class="label-income"
                >Is this your income?</label
              >
            </div>
            <div class="modal-body__frag">
              <input
                type="radio"
                name="action"
                id="cost"
                class="modal-body__control"
                value="cost"
              />
              <label for="cost" class="label-cost">Is this your cost?</label>
            </div>
            <div class="modal-body__temp">
              <button class="btn btn--secondary btn--cancel" type="button">
                Cancel
              </button>
              <button class="btn btn--primary btn--submit">Create one</button>
            </div>
            <div class="modal-error">Please fill out all the field!</div>
          </form>
        </div>
      </div>

      <div class="frame">
        <div class="frame-body">
          <div class="frame-body__header">
            <div class="frame-body__total">$4000</div>
            <div class="frame-body__head">salary income</div>
          </div>
          <ul class="frame-body__list">
            <li class="frame-body__item">
              <img
                src="./assets/img/calendar.png"
                class="frame-body__calendar"
                alt="calendar"
              />
              <div class="frame-body__content">
                <div class="frame-body__title">
                  Salary 2:
                  <span class="frame-body__money">$2000</span>
                </div>
                <div class="frame-body__description">First salary !</div>
                <div class="frame-body__time">
                  Created at:
                  <span class="frame-body__date">Tue Apr 12 2022</span>
                </div>
              </div>
            </li>
            <li class="frame-body__item">
              <img
                src="./assets/img/calendar.png"
                class="frame-body__calendar"
                alt="calendar"
              />
              <div class="frame-body__content">
                <div class="frame-body__title">
                  Salary 2:
                  <span class="frame-body__money">$2000</span>
                </div>
                <div class="frame-body__description">First salary !</div>
                <div class="frame-body__time">
                  Created at:
                  <span class="frame-body__date">Tue Apr 12 2022</span>
                </div>
              </div>
            </li>
          </ul>
          <div class="frame-body__close">
            <button class="btn btn-close">Close!</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  let data = [];
  // custom method
  const handleShowModal = (modalEl) => {
    modalEl.classList.add("show");
  };
  const handleHideModal = (modalEl) => {
    modalEl.classList.remove("show");
  };
  const handleFillDataToModal = (textEl) => {
    const modalTopic = document.querySelector(".modal-body__topic");
    if (!modalTopic) return;
    modalTopic.innerHTML = textEl.textContent;
  };
  const handleRenderBudget = (data) => {
    const listTemplateIncome = document.querySelector(".bill-template--income");
    const listTemplateCost = document.querySelector(".bill-template--cost");
    const budgetEl = document.querySelector(".header-budget__money");
    if (data.length <= 0) return;
    listTemplateIncome.innerHTML = "";
    listTemplateCost.innerHTML = "";
    const topicIncome = handleCreateElAndAssignClass(
      "div",
      `bill-template__title bill--income`,
      "Income"
    );
    const topicCost = handleCreateElAndAssignClass(
      "div",
      `bill-template__title bill--cost`,
      "Cost"
    );
    listTemplateIncome.appendChild(topicIncome);
    listTemplateCost.appendChild(topicCost);

    data.map((item, index) => {
      const liEl = handleCreateElAndAssignClass("li", "bill-template__box", "");
      const wrapEl = handleCreateElAndAssignClass(
        "div",
        `bill-template__wrap ${
          item?.action == "income" ? "bill--income" : "bill--cost"
        }`,
        ""
      );
      const imgEl = handleCreateElAndAssignClass(
        "img",
        "bill-template__img",
        ""
      );
      const contentEl = handleCreateElAndAssignClass(
        "div",
        "bill-template__content",
        ""
      );
      const titleEl = handleCreateElAndAssignClass(
        "p",
        `bill-template__title ${
          item?.action == "income" ? "bill--income" : "bill--cost"
        }`,
        item?.title
      );
      const priceEl = handleCreateElAndAssignClass(
        "p",
        "bill-template__price",
        `$${calculateBudgetByCategory(data, item?.category, item?.action)}`
      );
      const timeEl = handleCreateElAndAssignClass(
        "p",
        "bill-template__time",
        ""
      );
      const dateEl = handleCreateElAndAssignClass(
        "span",
        "bill-template__date",
        item?.createdAt
      );

      imgEl.setAttribute("src", `./assets/img/${item?.image}.png`);
      // append child

      contentEl.appendChild(titleEl);
      contentEl.appendChild(priceEl);
      timeEl.textContent = "Created at: ";
      timeEl.appendChild(dateEl);
      contentEl.appendChild(timeEl);
      wrapEl.removeEventListener("click", handleShowAndHideFrame);
      wrapEl.addEventListener("click", handleShowAndHideFrame);
      wrapEl.appendChild(imgEl);

      imgEl.dataset.category = item?.category;
      wrapEl.dataset.category = item?.category;
      imgEl.dataset.action = item?.action;
      wrapEl.dataset.action = item?.action;

      liEl.appendChild(wrapEl);
      liEl.appendChild(contentEl);

      item?.action === "income"
        ? listTemplateIncome.appendChild(liEl)
        : listTemplateCost.appendChild(liEl);
      budgetEl.textContent = "$" + calculateTotalBudget(data);
    });
  };
  const handleCreateElAndAssignClass = (nameEl, className, textContent) => {
    const element = document.createElement(nameEl);
    element.setAttribute("class", className);
    element.textContent = textContent;
    return element;
  };
  const calculateTotalBudget = (data) => {
    if (!data) return 0;
    let total = 0;
    data.forEach((item) => {
      total += item.listItem.reduce(
        (acc, next) =>
          next.action === "income" ? acc + next.amount : acc - next.amount,
        0
      );
    });
    return total;
  };
  const checkCategoryIsExists = (data, category, action) => {
    if (!data) return;
    return data.some((item) => {
      return item.category === category && item.action === action;
    });
  };
  const findIndexByCategoryAndAction = (data, category, action) => {
    return data.findIndex(
      (item) => item.category === category && item.action === action
    );
  };
  const calculateBudgetByCategory = (data, category, action) => {
    if (!data || !category || !action) return 0;
    const index = findIndexByCategoryAndAction(data, category, action);
    if (index < 0) return 0;
    return data[index]?.listItem?.reduce((acc, item) => acc + item.amount, 0);
  };
  const handleShowAndHideFrame = (e) => {
    const listBoxEl = document.querySelectorAll(".bill-template__box");
    const frameEl = document.querySelector(".frame");
    const btnCloseEl = frameEl.querySelector(".btn-close");
    if (!listBoxEl || !frameEl) return;
    // hide & show frame
    frameEl.classList.add("show");
    const index = findIndexByCategoryAndAction(
      data,
      e.target.dataset.category,
      e.target.dataset.action
    );
    handleRenderFrameItem(data, index);

    btnCloseEl.onclick = null;
    btnCloseEl.onclick = () => {
      frameEl.classList.remove("show");
    };
  };
  const handleRenderFrameItem = (data, indexData) => {
    const listEl = document.querySelector(".frame-body__list");
    const totalEl = document.querySelector(".frame-body__total");
    const headEl = document.querySelector(".frame-body__head");
    listEl.innerHTML = "";
    data[indexData]?.listItem.map((item, index) => {
      // console.log(data);
      console.log(item);
      // console.log(title);

      if (!listEl || !item) return;

      const liEl = handleCreateElAndAssignClass("li", "frame-body__item", "");
      const calendarEl = handleCreateElAndAssignClass(
        "img",
        "frame-body__calendar",
        ""
      );
      calendarEl.setAttribute("src", "./assets/img/calendar.png");
      const contentEl = handleCreateElAndAssignClass(
        "div",
        "frame-body__content",
        ""
      );
      const titleEl = handleCreateElAndAssignClass(
        "div",
        "frame-body__title",
        `${item?.title}`
      );
      const moneyEl = handleCreateElAndAssignClass(
        "span",
        "frame-body__money",
        `:  $${item?.amount}`
      );
      const descriptionEl = handleCreateElAndAssignClass(
        "div",
        "frame-body__description",
        `${item?.description}`
      );
      const timeEl = handleCreateElAndAssignClass(
        "div",
        "frame-body__time",
        ""
      );
      const dateEl = handleCreateElAndAssignClass(
        "span",
        "frame-body__date",
        `${item?.createdAt}`
      );

      titleEl.appendChild(moneyEl);
      timeEl.textContent = "Created at: ";
      timeEl.appendChild(dateEl);

      contentEl.appendChild(titleEl);
      contentEl.appendChild(descriptionEl);
      contentEl.appendChild(timeEl);

      liEl.appendChild(calendarEl);
      liEl.appendChild(contentEl);
      listEl.appendChild(liEl);
      headEl.textContent = `${data[indexData]?.title}`;
      totalEl.textContent = `$${data[indexData]?.listItem?.reduce(
        (acc, o) => acc + o?.amount,
        0
      )}`;
    });
  };

  // slide show logic
  (() => {
    // need fix to dynamic item show
    const QUANTITY_ITEM_SHOW = 5;
    const budgetList = Array.from(
      document.querySelectorAll(".category-right__item")
    );
    const btnPrev = document.querySelector(".category-left__prev");
    const btnNext = document.querySelector(".category-left__next");
    let countNext = 0;
    let countPrev;
    if (!budgetList || !btnPrev || !btnNext) return;
    btnNext.addEventListener("click", function () {
      if (countNext >= budgetList.length - QUANTITY_ITEM_SHOW) return;
      countNext += QUANTITY_ITEM_SHOW;
      budgetList.map((item, index) => {
        item.style.transform = "translateX(" + -120 * countNext + "px" + ")";
      });
    });
    btnPrev.addEventListener("click", function () {
      countPrev = countNext;
      if (countPrev == 0) return;
      countPrev -= QUANTITY_ITEM_SHOW;
      countNext -= QUANTITY_ITEM_SHOW;
      budgetList.map((item, index) => {
        item.style.transform = "translateX(" + -120 * countPrev + "px" + ")";
      });
    });
  })();

  // handle logic submit form and show + hide modal
  (() => {
    const modalEl = document.querySelector(".modal");
    const listCategories = document.querySelectorAll(".category-right__item");
    const modalFormEl = document.querySelector(".modal-body__form");
    const btnSubmit = document.querySelector(".btn--submit");
    const btnCancel = document.querySelector(".btn--cancel");
    const modalError = modalFormEl.querySelector(".modal-error");
    let textEl;

    if (!modalEl || !listCategories) return;
    listCategories.forEach((category, index) => {
      category.addEventListener("click", function () {
        handleShowModal(modalEl);
        textEl = category.querySelector(".category-right__text");
        handleFillDataToModal(textEl);
      });
    });

    modalFormEl.addEventListener("submit", function (e) {
      e.preventDefault();
      const amountEl = modalFormEl.querySelector("input[name='amount']");
      const titleEl = modalFormEl.querySelector("input[name='title']");
      const descEl = modalFormEl.querySelector("textarea[name='description']");
      const actionEl = modalFormEl.querySelector(
        "input[name='action']:checked"
      );
      if (
        amountEl?.value == "" ||
        titleEl?.value == "" ||
        descEl?.value == "" ||
        actionEl?.value == ""
      ) {
        modalError.classList.add("show");
        return;
      }
      const obj = {
        title: textEl?.textContent + ` ${actionEl?.value}`,
        category: textEl?.textContent,
        action: actionEl?.value,
        createdAt: new Date().toString().slice(0, 15),
        image: `${textEl?.textContent}`.toLocaleLowerCase(),
      };
      const objChild = {
        amount: +amountEl?.value,
        title: titleEl.value,
        description: descEl?.value,
        action: actionEl?.value,
        createdAt: new Date().toString().slice(0, 15),
      };
      if (checkCategoryIsExists(data, textEl?.textContent, actionEl?.value)) {
        const index = findIndexByCategoryAndAction(
          data,
          textEl?.textContent,
          actionEl?.value
        );
        data[index]?.listItem.push(objChild);
      } else {
        obj.listItem = [];
        data.push(obj);
        const index = findIndexByCategoryAndAction(
          data,
          textEl?.textContent,
          actionEl?.value
        );
        data[index]?.listItem.push(objChild);
      }
      handleRenderBudget(data);
      modalFormEl.reset();
      modalError.classList.remove("show");
      modalEl.classList.remove("show");
    });

    btnCancel.addEventListener("click", function () {
      modalEl.classList.remove("show");
      modalError.classList.remove("show");
    });

    handleRenderBudget(data);
  })();
</script>
